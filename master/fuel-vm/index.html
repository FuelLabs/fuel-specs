<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>FuelVM - Fuel Specifications</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Fuel Specifications</a></li><li class="chapter-item expanded "><a href="../tx-format/index.html"><strong aria-hidden="true">1.</strong> Transaction Format</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tx-format/consensus_parameters.html"><strong aria-hidden="true">1.1.</strong> Consensus Parameters</a></li><li class="chapter-item expanded "><a href="../tx-format/transaction.html"><strong aria-hidden="true">1.2.</strong> Transaction</a></li><li class="chapter-item expanded "><a href="../tx-format/upgrade_purpose.html"><strong aria-hidden="true">1.3.</strong> UpgradePurpose</a></li><li class="chapter-item expanded "><a href="../tx-format/policy.html"><strong aria-hidden="true">1.4.</strong> Policy</a></li><li class="chapter-item expanded "><a href="../tx-format/input.html"><strong aria-hidden="true">1.5.</strong> Input</a></li><li class="chapter-item expanded "><a href="../tx-format/output.html"><strong aria-hidden="true">1.6.</strong> Output</a></li><li class="chapter-item expanded "><a href="../tx-format/witness.html"><strong aria-hidden="true">1.7.</strong> Witness</a></li><li class="chapter-item expanded "><a href="../tx-format/tx-pointer.html"><strong aria-hidden="true">1.8.</strong> Transaction Pointer</a></li></ol></li><li class="chapter-item expanded "><a href="../identifiers/index.html"><strong aria-hidden="true">2.</strong> Computing Identifiers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../identifiers/asset.html"><strong aria-hidden="true">2.1.</strong> Asset ID</a></li><li class="chapter-item expanded "><a href="../identifiers/blob-id.html"><strong aria-hidden="true">2.2.</strong> Blob ID</a></li><li class="chapter-item expanded "><a href="../identifiers/contract-id.html"><strong aria-hidden="true">2.3.</strong> Contract ID</a></li><li class="chapter-item expanded "><a href="../identifiers/predicate-id.html"><strong aria-hidden="true">2.4.</strong> Predicate ID</a></li><li class="chapter-item expanded "><a href="../identifiers/transaction-id.html"><strong aria-hidden="true">2.5.</strong> Transaction ID</a></li><li class="chapter-item expanded "><a href="../identifiers/utxo-id.html"><strong aria-hidden="true">2.6.</strong> UTXO ID</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol/index.html"><strong aria-hidden="true">3.</strong> Protocol</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/tx-validity.html"><strong aria-hidden="true">3.1.</strong> Transaction Validity Rules</a></li><li class="chapter-item expanded "><a href="../protocol/cryptographic-primitives.html"><strong aria-hidden="true">3.2.</strong> Cryptographic Primitives</a></li><li class="chapter-item expanded "><a href="../protocol/storage-initialization.html"><strong aria-hidden="true">3.3.</strong> Storage Slot Initialization</a></li><li class="chapter-item expanded "><a href="../protocol/block-header.html"><strong aria-hidden="true">3.4.</strong> Block Header Format</a></li><li class="chapter-item expanded "><a href="../protocol/relayer.html"><strong aria-hidden="true">3.5.</strong> Layer 1 Relayer/Bridge Protocol</a></li></ol></li><li class="chapter-item expanded "><a href="../abi/index.html"><strong aria-hidden="true">4.</strong> Application Binary Interface (ABI)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../abi/json-abi-format.html"><strong aria-hidden="true">4.1.</strong> JSON ABI Format</a></li><li class="chapter-item expanded "><a href="../abi/receipts.html"><strong aria-hidden="true">4.2.</strong> Receipts</a></li><li class="chapter-item expanded "><a href="../abi/fn-selector-encoding.html"><strong aria-hidden="true">4.3.</strong> Function Selector Encoding</a></li><li class="chapter-item expanded "><a href="../abi/argument-encoding.html"><strong aria-hidden="true">4.4.</strong> Argument Encoding</a></li><li class="chapter-item expanded "><a href="../abi/hash-based-ids.html"><strong aria-hidden="true">4.5.</strong> Hash Based Ids</a></li></ol></li><li class="chapter-item expanded "><a href="../fuel-vm/index.html" class="active"><strong aria-hidden="true">5.</strong> FuelVM</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fuel-vm/instruction-set.html"><strong aria-hidden="true">5.1.</strong> Instruction Set</a></li></ol></li><li class="chapter-item expanded "><a href="../networks/index.html"><strong aria-hidden="true">6.</strong> Networks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../networks/poa.html"><strong aria-hidden="true">6.1.</strong> Proof of Authority (PoA)</a></li></ol></li><li class="chapter-item expanded "><a href="../tests/index.html"><strong aria-hidden="true">7.</strong> Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tests/sparse-merkle-tree-tests.html"><strong aria-hidden="true">7.1.</strong> Sparse Merkle Tree</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fuel Specifications</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/FuelLabs/fuel-specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="fuel-vm-specification"><a class="header" href="#fuel-vm-specification">Fuel VM Specification</a></h1>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#parameters">Parameters</a></li>
<li><a href="#semantics">Semantics</a></li>
<li><a href="#flags">Flags</a></li>
<li><a href="#instruction-set">Instruction Set</a></li>
<li><a href="#vm-initialization">VM Initialization</a></li>
<li><a href="#contexts">Contexts</a>
<ul>
<li><a href="#predicate-estimation-and-verification">Predicate Estimation and Verification</a></li>
<li><a href="#script-execution">Script Execution</a></li>
<li><a href="#call">Call</a></li>
</ul>
</li>
<li><a href="#call-frames">Call Frames</a></li>
<li><a href="#ownership">Ownership</a></li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>This document provides the specification for the Fuel Virtual Machine (FuelVM). The specification covers the types, instruction set, and execution semantics.</p>
<h2 id="parameters"><a class="header" href="#parameters">Parameters</a></h2>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>value</th><th>note</th></tr></thead><tbody>
<tr><td><code>CONTRACT_MAX_SIZE</code></td><td><code>uint64</code></td><td></td><td>Maximum contract size, in bytes.</td></tr>
<tr><td><code>VM_MAX_RAM</code></td><td><code>uint64</code></td><td><code>2**26</code></td><td>64 MiB.</td></tr>
<tr><td><code>MESSAGE_MAX_DATA_SIZE</code></td><td><code>uint64</code></td><td></td><td>Maximum size of message data, in bytes.</td></tr>
</tbody></table>
</div>
<h2 id="semantics"><a class="header" href="#semantics">Semantics</a></h2>
<p>FuelVM instructions are exactly 32 bits (4 bytes) wide and comprise of a combination of:</p>
<ul>
<li>Opcode: 8 bits</li>
<li>Register/special register (see below) identifier: 6 bits</li>
<li>Immediate value: 12, 18, or 24 bits, depending on operation</li>
</ul>
<p>Of the 64 registers (6-bit register address space), the first <code>16</code> are reserved:</p>
<div class="table-wrapper"><table><thead><tr><th>value</th><th>register</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td><code>0x00</code></td><td><code>$zero</code></td><td>zero</td><td>Contains zero (<code>0</code>), for convenience.</td></tr>
<tr><td><code>0x01</code></td><td><code>$one</code></td><td>one</td><td>Contains one (<code>1</code>), for convenience.</td></tr>
<tr><td><code>0x02</code></td><td><code>$of</code></td><td>overflow</td><td>Contains overflow/underflow of addition, subtraction, and multiplication.</td></tr>
<tr><td><code>0x03</code></td><td><code>$pc</code></td><td>program counter</td><td>The program counter. Memory address of the current instruction.</td></tr>
<tr><td><code>0x04</code></td><td><code>$ssp</code></td><td>stack start pointer</td><td>Memory address of bottom of current writable stack area.</td></tr>
<tr><td><code>0x05</code></td><td><code>$sp</code></td><td>stack pointer</td><td>Memory address on top of current writable stack area (points to free memory).</td></tr>
<tr><td><code>0x06</code></td><td><code>$fp</code></td><td>frame pointer</td><td>Memory address of beginning of current call frame.</td></tr>
<tr><td><code>0x07</code></td><td><code>$hp</code></td><td>heap pointer</td><td>Memory address below the current bottom of the heap (points to used/OOB memory).</td></tr>
<tr><td><code>0x08</code></td><td><code>$err</code></td><td>error</td><td>Error codes for particular operations.</td></tr>
<tr><td><code>0x09</code></td><td><code>$ggas</code></td><td>global gas</td><td>Remaining gas globally.</td></tr>
<tr><td><code>0x0A</code></td><td><code>$cgas</code></td><td>context gas</td><td>Remaining gas in the context.</td></tr>
<tr><td><code>0x0B</code></td><td><code>$bal</code></td><td>balance</td><td>Received balance for this context.</td></tr>
<tr><td><code>0x0C</code></td><td><code>$is</code></td><td>instructions start</td><td>Pointer to the start of the currently-executing code.</td></tr>
<tr><td><code>0x0D</code></td><td><code>$ret</code></td><td>return value</td><td>Return value or pointer.</td></tr>
<tr><td><code>0x0E</code></td><td><code>$retl</code></td><td>return length</td><td>Return value length in bytes.</td></tr>
<tr><td><code>0x0F</code></td><td><code>$flag</code></td><td>flags</td><td>Flags register.</td></tr>
</tbody></table>
</div>
<p>Integers are represented in <a href="https://en.wikipedia.org/wiki/Endianness">big-endian</a> format, and all operations are unsigned. Boolean <code>false</code> is <code>0</code> and Boolean <code>true</code> is <code>1</code>.</p>
<p>Registers are 64 bits (8 bytes) wide. Words are the same width as registers.</p>
<p>Persistent state (i.e. storage) is a key-value store with 32-byte keys and 32-byte values. Each contract has its own persistent state that is independent of other contracts. This is committed to in a Sparse Binary Merkle Tree.</p>
<h2 id="flags"><a class="header" href="#flags">Flags</a></h2>
<div class="table-wrapper"><table><thead><tr><th>value</th><th>name</th><th>description</th></tr></thead><tbody>
<tr><td><code>0x01</code></td><td><code>F_UNSAFEMATH</code></td><td>If set, undefined arithmetic zeroes target and sets <code>$err</code> without panic.</td></tr>
<tr><td><code>0x02</code></td><td><code>F_WRAPPING</code></td><td>If set, overflowing arithmetic wraps around and sets <code>$of</code> without panic.</td></tr>
</tbody></table>
</div>
<p>All other flags are reserved, any must be set to zero.</p>
<h2 id="instruction-set"><a class="header" href="#instruction-set">Instruction Set</a></h2>
<p>A complete instruction set of the Fuel VM is documented in <a href="./instruction-set.html">the following page</a>.</p>
<h2 id="vm-initialization"><a class="header" href="#vm-initialization">VM Initialization</a></h2>
<p>Every time the VM runs, a single monolithic memory of size <code>VM_MAX_RAM</code> bytes is allocated, indexed by individual byte. A stack and heap memory model is used, allowing for dynamic memory allocation in higher-level languages. The stack begins at <code>0</code> and grows upward. The heap begins at <code>VM_MAX_RAM</code> and grows downward.</p>
<p>To initialize the VM, the following is pushed on the stack sequentially:</p>
<ol>
<li>Transaction hash (<code>byte[32]</code>, word-aligned), computed as defined <a href="../identifiers/transaction-id.html">here</a>.</li>
<li>Base asset ID (<code>byte[32]</code>, word-aligned)</li>
<li><a href="../tx-format/consensus_parameters.html"><code>MAX_INPUTS</code></a> pairs of <code>(asset_id: byte[32], balance: uint64)</code>, of:
<ol>
<li>For <a href="#predicate-estimation-and-verification">predicate estimation and verification</a>, zeroes.</li>
<li>For <a href="#script-execution">script execution</a>, the free balance for each asset ID seen in the transaction's inputs, ordered in ascending order. If there are fewer than <code>MAX_INPUTS</code> asset IDs, the pair has a value of zero.</li>
</ol>
</li>
<li>Transaction length, in bytes (<code>uint64</code>, word-aligned).</li>
<li>The <a href="../tx-format/index.html">transaction, serialized</a>.</li>
</ol>
<p>Then the following registers are initialized (without explicit initialization, all registers are initialized to zero):</p>
<ol>
<li><code>$ssp = 32 + 32 + MAX_INPUTS*(32+8) + size(tx))</code>: the writable stack area starts immediately after the serialized transaction in memory (see above).</li>
<li><code>$sp = $ssp</code>: writable stack area is empty to start.</li>
<li><code>$hp = VM_MAX_RAM</code>: the heap area begins at the top and is empty to start.</li>
</ol>
<h2 id="contexts"><a class="header" href="#contexts">Contexts</a></h2>
<p>There are 4 <em>contexts</em> in the FuelVM: <a href="#predicate-estimation-and-verification">predicate estimation and verification</a>, <a href="#script-execution">scripts</a>, and <a href="#call">calls</a>. A context is an isolated execution environment with defined <a href="#ownership">memory ownership</a> and can be <em>external</em> or <em>internal</em>:</p>
<ul>
<li>External: predicate and script. <code>$fp</code> will be zero.</li>
<li>Internal: call. <code>$fp</code> will be non-zero.</li>
</ul>
<p><a href="./instruction-set.html#return-return-from-call">Returning</a> from a context behaves differently depending on whether the context is external or internal.</p>
<h3 id="predicate-estimation-and-verification"><a class="header" href="#predicate-estimation-and-verification">Predicate Estimation and Verification</a></h3>
<p>There are two ways to run predicates on the VM:</p>
<ol>
<li>Estimation: runs the predicate and updates the amount of gas used</li>
<li>Verification: runs the predicate and verifies the amount of gas used matches the input</li>
</ol>
<p>For any input of type <a href="../tx-format/input.html#inputcoin"><code>InputType.Coin</code></a> or <a href="../tx-format/input.html#inputmessage"><code>InputType.Message</code></a>, a non-zero <code>predicateLength</code> field means the UTXO being spent is a <a href="https://en.bitcoin.it/P2SH"><code>P2SH</code></a> rather than a <a href="https://en.bitcoin.it/P2PKH"><code>P2PKH</code></a> output.</p>
<p>For each such input in the transaction, the VM is <a href="#vm-initialization">initialized</a>, then:</p>
<ol>
<li><code>$pc</code> and <code>$is</code> are set to the start of the input's <code>predicate</code> field.</li>
<li><code>$ggas</code> and <code>$cgas</code> are set to <code>MAX_GAS_PER_PREDICATE</code> for estimation, and <code>predicateGasUsed</code> for verification.</li>
</ol>
<p>Predicate execution will fail if gas is exhausted during execution.</p>
<p>During predicate mode, hitting any <a href="./instruction-set.html#contract-instructions">contract instruction</a> (except <code>ldc</code> with non-contract target) causes predicate verification to halt, returning Boolean <code>false</code>.</p>
<p>A predicate that halts without returning Boolean <code>true</code> would not pass verification, making the entire transaction invalid. Note that predicate return value is monotonic with respect to time (i.e. if a predicate evaluates to <code>true</code> then it will always evaluate to <code>true</code> in the future).</p>
<p>After successful execution, the run mode is determines the final step:</p>
<ol>
<li>Estimation: <code>predicateGasUsed</code> is set to <code>MAX_GAS_PER_PREDICATE - $ggas</code>.</li>
<li>Verification: if <code>$ggas</code> is non-zero, predicate verification fails.</li>
</ol>
<h3 id="script-execution"><a class="header" href="#script-execution">Script Execution</a></h3>
<p>If script bytecode is present, transaction validation requires execution.</p>
<p>The VM is <a href="#vm-initialization">initialized</a>, then:</p>
<ol>
<li><code>$pc</code> and <code>$is</code> are set to the start of the transaction's script bytecode.</li>
<li><code>$ggas</code> and <code>$cgas</code> are set to <code>tx.scriptGasLimit</code>.</li>
</ol>
<p>Following initialization, execution begins.</p>
<p>For each instruction, its gas cost <code>gc</code> is first computed. If <code>gc &gt; $cgas</code>, deduct <code>$cgas</code> from <code>$ggas</code> and <code>$cgas</code> (i.e. spend all of <code>$cgas</code> and no more), then <a href="./instruction-set.html#rvrt-revert">revert</a> immediately without actually executing the instruction. Otherwise, deduct <code>gc</code> from <code>$ggas</code> and <code>$cgas</code>.</p>
<p>After the script has been executed, <code>tx.receiptsRoot</code> is updated to contain the Merkle root of the receipts, <a href="../tx-format/transaction.html#%60TransactionScript%60">as described in the <code>TransactionScript</code> spec</a>.</p>
<h3 id="call"><a class="header" href="#call">Call</a></h3>
<p>Call context is entered via <a href="./instruction-set.html#call-call-contract"><code>CALL</code> instruction</a>. It's also called <em>internal context</em>, or <em>contract context</em>. Call context is used to access state of a contract.</p>
<h2 id="call-frames"><a class="header" href="#call-frames">Call Frames</a></h2>
<p>Cross-contract calls push a <em>call frame</em> onto the stack, similar to a stack frame used in regular languages for function calls (which may be used by a high-level language that targets the FuelVM). The distinction is as follows:</p>
<ol>
<li>Stack frames: store metadata across trusted internal (i.e. intra-contract) function calls. Not supported natively by the FuelVM, but may be used as an abstraction at a higher layer.</li>
<li>Call frames: store metadata across untrusted external (i.e. inter-contract) calls. Supported natively by the FuelVM.</li>
</ol>
<p>Call frames are needed to ensure that the called contract cannot mutate the running state of the current executing contract. They segment access rights for memory: the currently-executing contracts may only write to their own call frame and their own heap.</p>
<p>A call frame consists of the following, word-aligned:</p>
<div class="table-wrapper"><table><thead><tr><th>bytes</th><th>type</th><th>value</th><th>description</th></tr></thead><tbody>
<tr><td></td><td></td><td></td><td><strong>Unwritable area begins.</strong></td></tr>
<tr><td>32</td><td><code>byte[32]</code></td><td><code>to</code></td><td>Contract ID for this call.</td></tr>
<tr><td>32</td><td><code>byte[32]</code></td><td><code>asset_id</code></td><td>asset ID of forwarded coins.</td></tr>
<tr><td>8*64</td><td><code>byte[8][64]</code></td><td><code>regs</code></td><td>Saved registers from previous context.</td></tr>
<tr><td>8</td><td><code>uint64</code></td><td><code>codesize</code></td><td>Code size in bytes, padded to the next word boundary.</td></tr>
<tr><td>8</td><td><code>byte[8]</code></td><td><code>param1</code></td><td>First parameter.</td></tr>
<tr><td>8</td><td><code>byte[8]</code></td><td><code>param2</code></td><td>Second parameter.</td></tr>
<tr><td>1*</td><td><code>byte[]</code></td><td><code>code</code></td><td>Zero-padded to 8-byte alignment, but individual instructions are not aligned.</td></tr>
<tr><td></td><td></td><td></td><td><strong>Unwritable area ends.</strong></td></tr>
<tr><td>*</td><td></td><td></td><td>Call frame's stack.</td></tr>
</tbody></table>
</div>
<h2 id="access-rights"><a class="header" href="#access-rights">Access rights</a></h2>
<p>Only memory that has been allocated is accessible.
In other words, memory between highest-ever <code>$sp</code> value and current <code>$hp</code>
is inaccessible. Attempting to read or write
memory that has not been allocated will result in VM panic.
Similarly reads or writes that cross from the stack to the heap
will panic. Note that stack remains readable even after stack
frame has been shrunk. However, if the heap is afterwards expanded
to cover that area, the crossing read prohibition still remains,
while all memory is accessible.</p>
<h3 id="ownership"><a class="header" href="#ownership">Ownership</a></h3>
<p>Whenever memory is written to (i.e. with <a href="./instruction-set.html#sb-store-byte"><code>SB</code></a> or <a href="./instruction-set.html#sw-store-word"><code>SW</code></a>), or write access is granted (i.e. with <a href="./instruction-set.html#call-call-contract"><code>CALL</code></a>), ownership must be checked.</p>
<p>If the context is external, the owned memory range is:</p>
<ol>
<li><code>[$ssp, $sp)</code>: the writable stack area.</li>
<li><code>[$hp, VM_MAX_RAM)</code>: the heap area allocated by this script or predicate.</li>
</ol>
<p>If the context is internal, the owned memory range for a call frame is:</p>
<ol>
<li><code>[$ssp, $sp)</code>: the writable stack area of the call frame.</li>
<li><code>[$hp, $fp-&gt;$hp)</code>: the heap area allocated by this call frame.</li>
</ol>
<h3 id="executability"><a class="header" href="#executability">Executability</a></h3>
<p>Memory is only executable in range <code>[$is, $ssp)</code>. Attempting to execute instructions outside these boundaries will cause a panic. This area never overlaps with writable memory, essentially providing <a href="https://en.wikipedia.org/wiki/W%5EX">W^X</a> protection.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../abi/hash-based-ids.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../fuel-vm/instruction-set.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../abi/hash-based-ids.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../fuel-vm/instruction-set.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
