<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Transaction - Fuel Specifications</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Fuel Specifications</a></li><li class="chapter-item expanded "><a href="../tx-format/index.html"><strong aria-hidden="true">1.</strong> Transaction Format</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tx-format/consensus_parameters.html"><strong aria-hidden="true">1.1.</strong> Consensus Parameters</a></li><li class="chapter-item expanded "><a href="../tx-format/transaction.html" class="active"><strong aria-hidden="true">1.2.</strong> Transaction</a></li><li class="chapter-item expanded "><a href="../tx-format/upgrade_purpose.html"><strong aria-hidden="true">1.3.</strong> UpgradePurpose</a></li><li class="chapter-item expanded "><a href="../tx-format/policy.html"><strong aria-hidden="true">1.4.</strong> Policy</a></li><li class="chapter-item expanded "><a href="../tx-format/input.html"><strong aria-hidden="true">1.5.</strong> Input</a></li><li class="chapter-item expanded "><a href="../tx-format/output.html"><strong aria-hidden="true">1.6.</strong> Output</a></li><li class="chapter-item expanded "><a href="../tx-format/witness.html"><strong aria-hidden="true">1.7.</strong> Witness</a></li><li class="chapter-item expanded "><a href="../tx-format/tx-pointer.html"><strong aria-hidden="true">1.8.</strong> Transaction Pointer</a></li></ol></li><li class="chapter-item expanded "><a href="../identifiers/index.html"><strong aria-hidden="true">2.</strong> Computing Identifiers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../identifiers/asset.html"><strong aria-hidden="true">2.1.</strong> Asset ID</a></li><li class="chapter-item expanded "><a href="../identifiers/blob-id.html"><strong aria-hidden="true">2.2.</strong> Blob ID</a></li><li class="chapter-item expanded "><a href="../identifiers/contract-id.html"><strong aria-hidden="true">2.3.</strong> Contract ID</a></li><li class="chapter-item expanded "><a href="../identifiers/predicate-id.html"><strong aria-hidden="true">2.4.</strong> Predicate ID</a></li><li class="chapter-item expanded "><a href="../identifiers/transaction-id.html"><strong aria-hidden="true">2.5.</strong> Transaction ID</a></li><li class="chapter-item expanded "><a href="../identifiers/utxo-id.html"><strong aria-hidden="true">2.6.</strong> UTXO ID</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol/index.html"><strong aria-hidden="true">3.</strong> Protocol</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol/tx-validity.html"><strong aria-hidden="true">3.1.</strong> Transaction Validity Rules</a></li><li class="chapter-item expanded "><a href="../protocol/cryptographic-primitives.html"><strong aria-hidden="true">3.2.</strong> Cryptographic Primitives</a></li><li class="chapter-item expanded "><a href="../protocol/storage-initialization.html"><strong aria-hidden="true">3.3.</strong> Storage Slot Initialization</a></li><li class="chapter-item expanded "><a href="../protocol/block-header.html"><strong aria-hidden="true">3.4.</strong> Block Header Format</a></li><li class="chapter-item expanded "><a href="../protocol/relayer.html"><strong aria-hidden="true">3.5.</strong> Layer 1 Relayer/Bridge Protocol</a></li></ol></li><li class="chapter-item expanded "><a href="../abi/index.html"><strong aria-hidden="true">4.</strong> Application Binary Interface (ABI)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../abi/json-abi-format.html"><strong aria-hidden="true">4.1.</strong> JSON ABI Format</a></li><li class="chapter-item expanded "><a href="../abi/receipts.html"><strong aria-hidden="true">4.2.</strong> Receipts</a></li><li class="chapter-item expanded "><a href="../abi/fn-selector-encoding.html"><strong aria-hidden="true">4.3.</strong> Function Selector Encoding</a></li><li class="chapter-item expanded "><a href="../abi/argument-encoding.html"><strong aria-hidden="true">4.4.</strong> Argument Encoding</a></li><li class="chapter-item expanded "><a href="../abi/hash-based-ids.html"><strong aria-hidden="true">4.5.</strong> Hash Based Ids</a></li></ol></li><li class="chapter-item expanded "><a href="../fuel-vm/index.html"><strong aria-hidden="true">5.</strong> FuelVM</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fuel-vm/instruction-set.html"><strong aria-hidden="true">5.1.</strong> Instruction Set</a></li></ol></li><li class="chapter-item expanded "><a href="../networks/index.html"><strong aria-hidden="true">6.</strong> Networks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../networks/poa.html"><strong aria-hidden="true">6.1.</strong> Proof of Authority (PoA)</a></li></ol></li><li class="chapter-item expanded "><a href="../tests/index.html"><strong aria-hidden="true">7.</strong> Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../tests/sparse-merkle-tree-tests.html"><strong aria-hidden="true">7.1.</strong> Sparse Merkle Tree</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fuel Specifications</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/FuelLabs/fuel-specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="transaction"><a class="header" href="#transaction">Transaction</a></h1>
<pre><code class="language-c++">enum TransactionType : uint8 {
    Script = 0,
    Create = 1,
    Mint = 2,
    Upgrade = 3,
    Upload = 4,
    Blob = 5,
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>type</code></td><td><a href="#transaction"><code>TransactionType</code></a></td><td>Transaction type.</td></tr>
<tr><td><code>data</code></td><td>One of <a href="#transactionscript"><code>TransactionScript</code></a>, <a href="#transactioncreate"><code>TransactionCreate</code></a>, <a href="#transactionmint"><code>TransactionMint</code></a>, <a href="#transactionupgrade"><code>TransactionUpgrade</code></a>, or <a href="#transactionupload"><code>TransactionUpload</code></a></td><td>Transaction data.</td></tr>
</tbody></table>
</div>
<p>Given helper <code>max_gas()</code> returns the maximum gas that the transaction can use.
Given helper <code>count_ones()</code> that returns the number of ones in the binary representation of a field.
Given helper <code>count_variants()</code> that returns the number of variants in an enum.
Given helper <code>sum_variants()</code> that sums all variants of an enum.</p>
<p>Transaction is invalid if:</p>
<ul>
<li><code>type</code> is not valid <code>TransactionType</code> value</li>
<li><code>inputsCount &gt; MAX_INPUTS</code></li>
<li><code>outputsCount &gt; MAX_OUTPUTS</code></li>
<li><code>witnessesCount &gt; MAX_WITNESSES</code></li>
<li><code>size &gt; MAX_TRANSACTION_SIZE</code>. The size of a transaction is calculated as the sum of the sizes of its static and dynamic parts, as determined by canonical serialization.</li>
<li>No inputs are of type <code>InputType.Coin</code> or <code>InputType.Message</code> with <code>input.dataLength</code> == 0</li>
<li>More than one output is of type <code>OutputType.Change</code> for any asset ID in the input set</li>
<li>More than one output is of type <code>OutputType.Change</code> with identical <code>asset_id</code> fields.</li>
<li>Any output is of type <code>OutputType.Change</code> for any asset ID not in the input set</li>
<li>More than one input of type <code>InputType.Coin</code> for any <a href="../identifiers/utxo-id.html#coin-id">Coin ID</a> in the input set</li>
<li>More than one input of type <code>InputType.Contract</code> for any <a href="../identifiers/utxo-id.html#contract-id">Contract ID</a> in the input set</li>
<li>More than one input of type <code>InputType.Message</code> for any <a href="../identifiers/utxo-id.html#message-id">Message ID</a> in the input set</li>
<li>if <code>type != TransactionType.Mint</code>
<ul>
<li><code>max_gas(tx) &gt; MAX_GAS_PER_TX</code></li>
<li>No policy of type <code>PolicyType.MaxFee</code> is set</li>
<li><code>count_ones(policyTypes) &gt; count_variants(PolicyType)</code></li>
<li><code>policyTypes &gt; sum_variants(PolicyType)</code></li>
<li><code>len(policies) &gt; count_ones(policyTypes)</code></li>
</ul>
</li>
</ul>
<p>When serializing a transaction, fields are serialized as follows (with inner structs serialized recursively):</p>
<ol>
<li><code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code>: big-endian right-aligned to 8 bytes.</li>
<li><code>byte[32]</code>: as-is.</li>
<li><code>byte[]</code>: as-is, with padding zeroes aligned to 8 bytes.</li>
</ol>
<p>When deserializing a transaction, the reverse is done. If there are insufficient bytes or too many bytes, the transaction is invalid.</p>
<h2 id="transactionscript"><a class="header" href="#transactionscript"><code>TransactionScript</code></a></h2>
<pre><code class="language-c++">enum ReceiptType : uint8 {
    Call = 0,
    Return = 1,
    ReturnData = 2,
    Panic = 3,
    Revert = 4,
    Log = 5,
    LogData = 6,
    Transfer = 7,
    TransferOut = 8,
    ScriptResult = 9,
    MessageOut = 10,
    Mint = 11,
    Burn = 12,
}
</code></pre>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>scriptGasLimit</code></td><td><code>uint64</code></td><td>Gas limits the script execution.</td></tr>
<tr><td><code>receiptsRoot</code></td><td><code>byte[32]</code></td><td>Merkle root of receipts.</td></tr>
<tr><td><code>scriptLength</code></td><td><code>uint64</code></td><td>Script length, in instructions.</td></tr>
<tr><td><code>scriptDataLength</code></td><td><code>uint64</code></td><td>Length of script input data, in bytes.</td></tr>
<tr><td><code>policyTypes</code></td><td><code>uint32</code></td><td>Bitfield of used policy types.</td></tr>
<tr><td><code>inputsCount</code></td><td><code>uint16</code></td><td>Number of inputs.</td></tr>
<tr><td><code>outputsCount</code></td><td><code>uint16</code></td><td>Number of outputs.</td></tr>
<tr><td><code>witnessesCount</code></td><td><code>uint16</code></td><td>Number of witnesses.</td></tr>
<tr><td><code>script</code></td><td><code>byte[]</code></td><td>Script to execute.</td></tr>
<tr><td><code>scriptData</code></td><td><code>byte[]</code></td><td>Script input data (parameters).</td></tr>
<tr><td><code>policies</code></td><td><a href="./policy.html">Policy</a><code>[]</code></td><td>List of policies, sorted by <code>PolicyType</code>.</td></tr>
<tr><td><code>inputs</code></td><td><a href="./input.html">Input</a><code>[]</code></td><td>List of inputs.</td></tr>
<tr><td><code>outputs</code></td><td><a href="./output.html">Output</a><code>[]</code></td><td>List of outputs.</td></tr>
<tr><td><code>witnesses</code></td><td><a href="./witness.html">Witness</a><code>[]</code></td><td>List of witnesses.</td></tr>
</tbody></table>
</div>
<p>Given helper <code>len()</code> that returns the number of bytes of a field.</p>
<p>Transaction is invalid if:</p>
<ul>
<li>Any output is of type <code>OutputType.ContractCreated</code></li>
<li><code>scriptLength &gt; MAX_SCRIPT_LENGTH</code></li>
<li><code>scriptDataLength &gt; MAX_SCRIPT_DATA_LENGTH</code></li>
<li><code>scriptLength * 4 != len(script)</code></li>
<li><code>scriptDataLength != len(scriptData)</code></li>
</ul>
<blockquote>
<p><strong>Note:</strong> when signing a transaction, <code>receiptsRoot</code> is set to zero.</p>
<p><strong>Note:</strong> when verifying a predicate or executing a script, <code>receiptsRoot</code> is initialized to zero.</p>
</blockquote>
<p>The receipts root <code>receiptsRoot</code> is the root of the <a href="../protocol/cryptographic-primitives.html#binary-merkle-tree">binary Merkle tree</a> of receipts. If there are no receipts, its value is set to the root of the empty tree, i.e. <code>0xe3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</code>.</p>
<h2 id="transactioncreate"><a class="header" href="#transactioncreate"><code>TransactionCreate</code></a></h2>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>bytecodeWitnessIndex</code></td><td><code>uint16</code></td><td>Witness index of contract bytecode to create.</td></tr>
<tr><td><code>salt</code></td><td><code>byte[32]</code></td><td>Salt.</td></tr>
<tr><td><code>storageSlotsCount</code></td><td><code>uint64</code></td><td>Number of storage slots to initialize.</td></tr>
<tr><td><code>policyTypes</code></td><td><code>uint32</code></td><td>Bitfield of used policy types.</td></tr>
<tr><td><code>inputsCount</code></td><td><code>uint16</code></td><td>Number of inputs.</td></tr>
<tr><td><code>outputsCount</code></td><td><code>uint16</code></td><td>Number of outputs.</td></tr>
<tr><td><code>witnessesCount</code></td><td><code>uint16</code></td><td>Number of witnesses.</td></tr>
<tr><td><code>storageSlots</code></td><td><code>(byte[32], byte[32]])[]</code></td><td>List of storage slots to initialize (key, value).</td></tr>
<tr><td><code>policies</code></td><td><a href="./policy.html">Policy</a><code>[]</code></td><td>List of policies.</td></tr>
<tr><td><code>inputs</code></td><td><a href="./input.html">Input</a><code>[]</code></td><td>List of inputs.</td></tr>
<tr><td><code>outputs</code></td><td><a href="./output.html">Output</a><code>[]</code></td><td>List of outputs.</td></tr>
<tr><td><code>witnesses</code></td><td><a href="./witness.html">Witness</a><code>[]</code></td><td>List of witnesses.</td></tr>
</tbody></table>
</div>
<p>Transaction is invalid if:</p>
<ul>
<li>Any input is of type <code>InputType.Contract</code> or <code>InputType.Message</code> where <code>input.dataLength &gt; 0</code></li>
<li>Any input uses non-base asset.</li>
<li>Any output is of type <code>OutputType.Contract</code> or <code>OutputType.Variable</code> or <code>OutputType.Message</code></li>
<li>Any output is of type <code>OutputType.Change</code> with non-base <code>asset_id</code></li>
<li>It does not have exactly one output of type <code>OutputType.ContractCreated</code></li>
<li><code>tx.data.witnesses[bytecodeWitnessIndex].dataLength &gt; CONTRACT_MAX_SIZE</code></li>
<li><code>bytecodeWitnessIndex &gt;= tx.witnessesCount</code></li>
<li>The keys of <code>storageSlots</code> are not in ascending lexicographic order</li>
<li>The computed contract ID (see below) is not equal to the <code>contractID</code> of the one <code>OutputType.ContractCreated</code> output</li>
<li><code>storageSlotsCount &gt; MAX_STORAGE_SLOTS</code></li>
<li>The <a href="../protocol/cryptographic-primitives.html#sparse-merkle-tree">Sparse Merkle tree</a> root of <code>storageSlots</code> is not equal to the <code>stateRoot</code> of the one <code>OutputType.ContractCreated</code> output</li>
</ul>
<p>Creates a contract with contract ID as computed <a href="../identifiers/contract-id.html">here</a>.</p>
<h2 id="transactionmint"><a class="header" href="#transactionmint"><code>TransactionMint</code></a></h2>
<p>The transaction is created by the block producer and is not signed. Since it is not usable outside of block creation or execution, all fields must be fully set upon creation without any zeroing.
This means that the transaction ID must also include the correct <code>txPointer</code> value, not zeroed out.</p>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>txPointer</code></td><td><a href="./tx-pointer.html"><code>TXPointer</code></a></td><td>The location of the <code>Mint</code> transaction in the block.</td></tr>
<tr><td><code>inputContract</code></td><td><a href="./input.html"><code>InputContract</code></a></td><td>The contract UTXO that assets are minted to.</td></tr>
<tr><td><code>outputContract</code></td><td><a href="./output.html"><code>OutputContract</code></a></td><td>The contract UTXO that assets are being minted to.</td></tr>
<tr><td><code>mintAmount</code></td><td><code>uint64</code></td><td>The amount of funds minted.</td></tr>
<tr><td><code>mintAssetId</code></td><td><code>byte[32]</code></td><td>The asset IDs corresponding to the minted amount.</td></tr>
<tr><td><code>gasPrice</code></td><td><code>uint64</code></td><td>The gas price to be used in calculating all fees for transactions on block</td></tr>
</tbody></table>
</div>
<p>Transaction is invalid if:</p>
<ul>
<li><code>txPointer</code> is zero or doesn't match the block.</li>
<li><code>outputContract.inputIndex</code> is not zero</li>
</ul>
<h2 id="transactionupgrade"><a class="header" href="#transactionupgrade"><code>TransactionUpgrade</code></a></h2>
<p>The <code>Upgrade</code> transaction allows upgrading either consensus parameters or state transition function used by the network to produce future blocks. The <code>Upgrade Purpose</code> type defines the purpose of the upgrade.</p>
<p>The <code>Upgrade</code> transaction is chargeable, and the sender should pay for it. Transaction inputs should contain only base assets.</p>
<p>Only the privileged address from <a href="./consensus_parameters.html"><code>ConsensusParameters</code></a> can upgrade the network. The privileged address can be either a real account or a predicate.</p>
<p>When the upgrade type is <code>UpgradePurposeType.ConsensusParameters</code> serialized consensus parameters are available in the witnesses and the <code>Upgrade</code> transaction is self-contained because it has all the required information.</p>
<p>When the upgrade type is <code>UpgradePurposeType.StateTransition</code>, the <code>bytecodeRoot</code> field contains the Merkle root of the new bytecode of the state transition function. The bytecode should already be available on the blockchain at the upgrade point; otherwise, the upgrade will fail. The bytecode can be part of the genesis block or can be uploaded via the <code>TransactionUpload</code> transaction.</p>
<p>The block header contains information about which versions of consensus parameters and state transition function are used to produce a block, and the <code>Upgrade</code> transaction defines behavior corresponding to the version. When the block executes the <code>Upgrade</code> transaction, it defines new behavior for either <code>BlockHeader.consensusParametersVersion + 1</code> or <code>BlockHeader.stateTransitionBytecodeVersion + 1</code>(it depends on the purpose of the upgrade).</p>
<p>When the <code>Upgrade</code> transaction is included in the block, it doesn't affect the current block execution. Since behavior is now defined, the inclusion of the <code>Upgrade</code> transaction allows the production of the next block with a new version. The block producer can still continue to use the previous version and start using a new version later unless the state transition function forbids it.</p>
<p>The behavior is set once per version. It is forbidden to override the behavior of the network. Each behavior should have its own version. The version should grow monotonically without jumps.</p>
<p>The <code>BlockHeader.consensusParametersVersion</code> and <code>BlockHeader.stateTransitionBytecodeVersion</code> are independent and can grow at different speeds.</p>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>upgradePurpose</code></td><td><a href="./upgrade_purpose.html">UpgradePurpose</a></td><td>The purpose of the upgrade.</td></tr>
<tr><td><code>policyTypes</code></td><td><code>uint32</code></td><td>Bitfield of used policy types.</td></tr>
<tr><td><code>inputsCount</code></td><td><code>uint16</code></td><td>Number of inputs.</td></tr>
<tr><td><code>outputsCount</code></td><td><code>uint16</code></td><td>Number of outputs.</td></tr>
<tr><td><code>witnessesCount</code></td><td><code>uint16</code></td><td>Number of witnesses.</td></tr>
<tr><td><code>policies</code></td><td><a href="./policy.html">Policy</a><code>[]</code></td><td>List of policies.</td></tr>
<tr><td><code>inputs</code></td><td><a href="./input.html">Input</a><code>[]</code></td><td>List of inputs.</td></tr>
<tr><td><code>outputs</code></td><td><a href="./output.html">Output</a><code>[]</code></td><td>List of outputs.</td></tr>
<tr><td><code>witnesses</code></td><td><a href="./witness.html">Witness</a><code>[]</code></td><td>List of witnesses.</td></tr>
</tbody></table>
</div>
<p>Transaction is invalid if:</p>
<ul>
<li>Any input is of type <code>InputType.Contract</code> or <code>InputType.Message</code> where <code>input.dataLength &gt; 0</code></li>
<li>Any input uses non-base asset.</li>
<li>Any output is of type <code>OutputType.Contract</code> or <code>OutputType.Variable</code> or <code>OutputType.Message</code> or <code>OutputType.ContractCreated</code></li>
<li>Any output is of type <code>OutputType.Change</code> with non-base <code>asset_id</code></li>
<li>No input where <code>InputType.Message.owner == PRIVILEGED_ADDRESS</code> or <code>InputType.Coint.owner == PRIVILEGED_ADDRESS</code></li>
<li>The <code>UpgradePurpose</code> is invalid</li>
</ul>
<h2 id="transactionupload"><a class="header" href="#transactionupload"><code>TransactionUpload</code></a></h2>
<p>The <code>Upload</code> transaction allows the huge bytecode to be divided into subsections and uploaded slowly to the chain. The <a href="../protocol/cryptographic-primitives.html#binary-merkle-tree">Binary Merkle root</a> built on top of subsections is an identifier of the bytecode.</p>
<p>Each transaction uploads a subsection of the code and must contain proof of connection to the root. All subsections should be uploaded sequentially, which allows the concatenation of previously uploaded subsections with new subsection. The bytecode is considered final when the last subsection is uploaded, and future <code>Upload</code> transactions with the same <code>root</code> fields should be rejected.</p>
<p>When the bytecode is completed it can be used to upgrade the network.</p>
<p>The size of each subsection can be arbitrary; the only limit is the maximum number of subsections allowed by the network. The combination of the transaction gas limit and the number of subsections limits the final maximum size of the bytecode.</p>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>root</code></td><td><code>byte[32]</code></td><td>The root of the Merkle tree is created over the bytecode.</td></tr>
<tr><td><code>witnessIndex</code></td><td><code>uint16</code></td><td>The witness index of the subsection of the bytecode.</td></tr>
<tr><td><code>subsectionIndex</code></td><td><code>uint16</code></td><td>The index of the subsection of the bytecode.</td></tr>
<tr><td><code>subsectionsNumber</code></td><td><code>uint16</code></td><td>The total number of subsections on which bytecode was divided.</td></tr>
<tr><td><code>proofSetCount</code></td><td><code>uint16</code></td><td>Number of Merkle nodes in the proof.</td></tr>
<tr><td><code>policyTypes</code></td><td><code>uint32</code></td><td>Bitfield of used policy types.</td></tr>
<tr><td><code>inputsCount</code></td><td><code>uint16</code></td><td>Number of inputs.</td></tr>
<tr><td><code>outputsCount</code></td><td><code>uint16</code></td><td>Number of outputs.</td></tr>
<tr><td><code>witnessesCount</code></td><td><code>uint16</code></td><td>Number of witnesses.</td></tr>
<tr><td><code>proofSet</code></td><td><code>byte[32][]</code></td><td>The proof set of Merkle nodes to verify the connection of the subsection to the <code>root</code>.</td></tr>
<tr><td><code>policies</code></td><td><a href="./policy.html">Policy</a><code>[]</code></td><td>List of policies.</td></tr>
<tr><td><code>inputs</code></td><td><a href="./input.html">Input</a><code>[]</code></td><td>List of inputs.</td></tr>
<tr><td><code>outputs</code></td><td><a href="./output.html">Output</a><code>[]</code></td><td>List of outputs.</td></tr>
<tr><td><code>witnesses</code></td><td><a href="./witness.html">Witness</a><code>[]</code></td><td>List of witnesses.</td></tr>
</tbody></table>
</div>
<p>Transaction is invalid if:</p>
<ul>
<li>Any input is of type <code>InputType.Contract</code> or <code>InputType.Message</code> where <code>input.dataLength &gt; 0</code></li>
<li>Any input uses non-base asset.</li>
<li>Any output is of type <code>OutputType.Contract</code> or <code>OutputType.Variable</code> or <code>OutputType.Message</code> or <code>OutputType.ContractCreated</code></li>
<li>Any output is of type <code>OutputType.Change</code> with non-base <code>asset_id</code></li>
<li><code>witnessIndex &gt;= tx.witnessesCount</code></li>
<li><code>subsectionIndex</code> &gt;= <code>subsectionsNumber</code></li>
<li><code>subsectionsNumber &gt; MAX_BYTECODE_SUBSECTIONS</code></li>
<li>The <a href="../protocol/cryptographic-primitives.html#binary-merkle-tree">Binary Merkle tree</a> root calculated from <code>(witnesses[witnessIndex], subsectionIndex, subsectionsNumber, proofSet)</code> is not equal to the <code>root</code>. Root calculation is affected by all fields, so modification of one of them invalidates the proof.</li>
</ul>
<h2 id="transactionblob"><a class="header" href="#transactionblob"><code>TransactionBlob</code></a></h2>
<p>The <code>Blob</code> inserts a simple binary blob in the chain. It's raw immutable data that can be cheaply loaded by the VM and used as instructions or just data. Unlike <code>Create</code>, it doesn't hold any state or balances.</p>
<p><code>Blob</code>s are content-addressed, i.e. the they are uniquely identified by hash of the data field. Programs running on the VM can load an already-posted blob just by the hash, without having to specify it in contract inputs.</p>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>description</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>byte[32]</code></td><td>Blob id, i.e. hash of the data.</td></tr>
<tr><td><code>witnessIndex</code></td><td><code>uint16</code></td><td>The witness index of the data.</td></tr>
<tr><td><code>policyTypes</code></td><td><code>uint32</code></td><td>Bitfield of used policy types.</td></tr>
<tr><td><code>inputsCount</code></td><td><code>uint16</code></td><td>Number of inputs.</td></tr>
<tr><td><code>outputsCount</code></td><td><code>uint16</code></td><td>Number of outputs.</td></tr>
<tr><td><code>witnessesCount</code></td><td><code>uint16</code></td><td>Number of witnesses.</td></tr>
<tr><td><code>policies</code></td><td><a href="./policy.html">Policy</a><code>[]</code></td><td>List of policies.</td></tr>
<tr><td><code>inputs</code></td><td><a href="./input.html">Input</a><code>[]</code></td><td>List of inputs.</td></tr>
<tr><td><code>outputs</code></td><td><a href="./output.html">Output</a><code>[]</code></td><td>List of outputs.</td></tr>
<tr><td><code>witnesses</code></td><td><a href="./witness.html">Witness</a><code>[]</code></td><td>List of witnesses.</td></tr>
</tbody></table>
</div>
<p>Transaction is invalid if:</p>
<ul>
<li>Any input is of type <code>InputType.Contract</code> or <code>InputType.Message</code> where <code>input.dataLength &gt; 0</code></li>
<li>Any input uses non-base asset.</li>
<li>Any output is of type <code>OutputType.Contract</code> or <code>OutputType.Variable</code> or <code>OutputType.Message</code> or <code>OutputType.ContractCreated</code></li>
<li>Any output is of type <code>OutputType.Change</code> with non-base <code>asset_id</code></li>
<li><code>witnessIndex &gt;= tx.witnessesCount</code></li>
<li><code>sha256(witnesses[witnessIndex]) != id</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../tx-format/consensus_parameters.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../tx-format/upgrade_purpose.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../tx-format/consensus_parameters.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../tx-format/upgrade_purpose.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
